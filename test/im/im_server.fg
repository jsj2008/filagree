port = 9996

import '../mesh'   # shared mesh logic

server = [

    'id' : 'server',
    'clients' : [],

    'handle_message' : function(self, socket, ms1)

        if ms1.event == 'signup' then
            return self.handle_signup(ms1)
        else if ms1.event == 'signin' then
            return self.handle_signin(ms1)
        end
    end,

    'handle_signup' : function(self, ms2)
        if (not self.clients[ms2.from]) then
            self.clients[ms2.from] = ms2.password
            return ['event' : 'signup', 'result' : true]
        else
            return ['event' : 'signup', 'result' : false]
        end
    end,

    'handle_signin' : function(self, ms3)
        result = (self.clients[ms3.from] == ms3.password)
        return ['event' : 'signin', 'result' : result]
    end,

] + Mesh

####### main

sys.listen(port, server)    # server listens for incoming socket connections
sys.loop()